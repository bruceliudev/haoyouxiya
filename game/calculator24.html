<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>24点思维挑战</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            /* 调色板：暖色、明亮、不刺眼 */
            --bg-color: #FFF9F0; /* 极淡的暖米色背景 */
            --container-bg: #FFFFFF;
            
            /* 核心交互色 */
            --primary-orange: #FF9F43; /* 温暖的橙色 - 用于卡片 */
            --soft-blue: #54a0ff;      /* 柔和的蓝色 - 用于操作符 */
            --action-green: #1dd1a1;   /* 清新的绿色 - 用于提交 */
            --warm-red: #ff6b6b;       /* 柔和红 - 用于清除/错误 */
            
            /* 文字颜色 */
            --text-main: #57606f;
            --text-light: #a4b0be;
            
            /* 阴影系统 - 代替边框 */
            --shadow-soft: 0 10px 25px rgba(149, 157, 165, 0.1);
            --shadow-hover: 0 15px 35px rgba(149, 157, 165, 0.2);
            --shadow-inner: inset 0 2px 5px rgba(0,0,0,0.05);
        }

        body {
            font-family: 'Fredoka', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            user-select: none;
        }

        .container {
            background: var(--container-bg);
            /* 移除原来的实线边框，改用大圆角和柔和阴影 */
            border-radius: 30px;
            box-shadow: var(--shadow-soft);
            width: 100%;
            max-width: 500px; /* 稍微加宽 */
            padding: 40px 30px;
            text-align: center;
            transition: transform 0.3s ease;
        }

        h1 {
            margin: 0 0 30px 0;
            color: var(--text-main);
            font-size: 2rem;
            font-weight: 600;
            letter-spacing: 1px;
        }
        
        h1 span {
            color: var(--primary-orange);
        }

        /* 显示屏区域 - 更加开阔 */
        .display-screen {
            background: #F1F2F6;
            height: 80px; /* 更高 */
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.2rem;
            font-weight: 600;
            color: var(--text-main);
            margin-bottom: 35px;
            box-shadow: var(--shadow-inner);
            /* 移除边框 */
            border: none; 
            transition: all 0.3s ease;
        }

        .display-screen.success {
            background: #E3F9E5; /* 极淡绿 */
            color: #218c74;
        }

        .display-screen.error {
            background: #ffeae6; /* 极淡红 */
            color: #c23616;
            animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both;
        }

        /* 卡片区域 */
        .cards-area {
            display: flex;
            justify-content: space-between;
            margin-bottom: 35px;
            gap: 15px;
        }

        .card-btn {
            flex: 1;
            aspect-ratio: 1; /* 正方形 */
            background-color: var(--primary-orange);
            border: none; /* 无边框 */
            border-radius: 20px;
            font-size: 2rem;
            font-weight: 600;
            color: white;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 8px 0 #e58e3c; /* 3D底部厚度感，代替边框 */
            font-family: 'Fredoka', sans-serif;
            position: relative;
            top: 0;
        }

        .card-btn:active {
            top: 8px; /* 按下效果 */
            box-shadow: 0 0 0 #e58e3c;
        }
        
        /* 已使用的卡片状态 */
        .card-btn.disabled {
            background-color: #dfe4ea;
            color: #a4b0be;
            box-shadow: none;
            top: 8px; /* 保持按下的位置 */
            cursor: default;
        }

        /* 操作符区域 - 改为圆形按钮 */
        .controls-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 40px;
            justify-items: center;
        }

        .op-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%; /* 圆形 */
            border: none;
            background-color: #F1F2F6;
            color: var(--soft-blue);
            font-size: 1.4rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Fredoka', sans-serif;
        }

        .op-btn:hover {
            background-color: var(--soft-blue);
            color: white;
            transform: scale(1.1);
        }

        .op-btn:active {
            transform: scale(0.95);
        }

        /* 特殊功能按钮微调 */
        .op-btn.action-undo {
            color: #ffa502;
            font-size: 0.9rem; /* 文字稍微小一点 */
        }
        .op-btn.action-undo:hover { background-color: #ffa502; color: white; }

        .op-btn.action-clear {
            color: var(--warm-red);
            font-size: 0.9rem;
        }
        .op-btn.action-clear:hover { background-color: var(--warm-red); color: white; }

        /* 底部主按钮 - 胶囊形状 */
        .main-actions {
            display: flex;
            gap: 20px;
            justify-content: center;
        }

        .big-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 50px; /* 胶囊形 */
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            font-family: 'Fredoka', sans-serif;
            min-width: 100px;
        }

        .big-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .btn-reset { background-color: #F1F2F6; color: var(--text-main); }
        .btn-hint { background-color: #fff2cc; color: #ffa502; }
        .btn-submit { 
            background-color: var(--action-green); 
            color: white; 
            box-shadow: 0 5px 15px rgba(29, 209, 161, 0.3);
        }

        /* 提示消息 */
        .message {
            height: 20px;
            margin-top: 25px;
            font-size: 0.95rem;
            color: var(--text-light);
        }

        /* 动画定义 */
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }

    </style>
</head>
<body>

<div class="container">
    <h1>24点 <span>Challenge</span></h1>
    
    <div id="display" class="display-screen"></div>

    <div class="cards-area" id="cards-container">
        </div>

    <div class="controls-grid">
        <button class="op-btn" onclick="addOperator('+')">+</button>
        <button class="op-btn" onclick="addOperator('-')">-</button>
        <button class="op-btn" onclick="addOperator('*')">×</button>
        <button class="op-btn" onclick="addOperator('/')">÷</button>
        
        <button class="op-btn" onclick="addOperator('(')">(</button>
        <button class="op-btn" onclick="addOperator(')')">)</button>
        <button class="op-btn action-undo" onclick="undo()">撤销</button>
        <button class="op-btn action-clear" onclick="clearDisplay()">清空</button>
    </div>

    <div class="main-actions">
        <button class="big-btn btn-reset" onclick="initGame()">新的一局</button>
        <button class="big-btn btn-hint" onclick="showHint()">提示</button>
        <button class="big-btn btn-submit" onclick="checkResult()">确认提交</button>
    </div>
    
    <div class="message" id="message-area"></div>
</div>

<script>
    // --- 游戏逻辑核心代码 (保持不变) ---

    let currentNumbers = []; 
    let inputStack = [];     
    let usedCardIndices = [];
    let solution = "";       

    function initGame() {
        resetState();
        let solvable = false;
        while (!solvable) {
            currentNumbers = Array.from({length: 4}, () => Math.floor(Math.random() * 10) + 1);
            solution = solve24(currentNumbers);
            if (solution) solvable = true;
        }
        renderCards();
        showMessage("请用数字和符号计算出 24");
    }

    function resetState() {
        inputStack = [];
        usedCardIndices = [];
        updateDisplay();
        const display = document.getElementById('display');
        display.classList.remove('success', 'error');
    }

    function renderCards() {
        const container = document.getElementById('cards-container');
        container.innerHTML = '';
        currentNumbers.forEach((num, index) => {
            const btn = document.createElement('button');
            btn.className = 'card-btn';
            btn.textContent = num;
            btn.id = `card-${index}`;
            btn.onclick = () => addNumber(num, index);
            container.appendChild(btn);
        });
    }

    function addNumber(num, index) {
        if (usedCardIndices.includes(index)) return;
        if (inputStack.length > 0) {
            const last = inputStack[inputStack.length - 1];
            if (last.type === 'number') return; 
            if (last.value === ')') return; 
        }
        inputStack.push({ type: 'number', value: num, cardIndex: index });
        usedCardIndices.push(index);
        updateDisplay();
        updateCardStyles();
    }

    function addOperator(op) {
        if (inputStack.length === 0 && op !== '(') return; 
        const last = inputStack.length > 0 ? inputStack[inputStack.length - 1] : null;
        if (['+', '-', '*', '/'].includes(op)) {
             if (last && ['+', '-', '*', '/', '('].includes(last.value)) return;
             if (last && last.type === 'operator' && last.value !== ')') return;
        }
        if (op !== '(' && last && last.value === '(' && ['+', '-', '*', '/'].includes(op)) return;
        inputStack.push({ type: 'operator', value: op });
        updateDisplay();
    }

    function undo() {
        if (inputStack.length === 0) return;
        const removed = inputStack.pop();
        if (removed.type === 'number') {
            usedCardIndices = usedCardIndices.filter(idx => idx !== removed.cardIndex);
            updateCardStyles();
        }
        updateDisplay();
        document.getElementById('display').classList.remove('success', 'error');
    }

    function clearDisplay() {
        while(inputStack.length > 0) undo();
        showMessage("");
    }

    function updateDisplay() {
        const text = inputStack.map(item => {
            if (item.value === '*') return '×';
            if (item.value === '/') return '÷';
            return item.value;
        }).join(' ');
        // 如果为空，显示 placeholder
        document.getElementById('display').textContent = text || "";
    }

    function updateCardStyles() {
        currentNumbers.forEach((_, index) => {
            const btn = document.getElementById(`card-${index}`);
            if (btn) {
                if (usedCardIndices.includes(index)) {
                    btn.classList.add('disabled');
                } else {
                    btn.classList.remove('disabled');
                }
            }
        });
    }

    function showHint() {
        if (!solution) return;
        const displaySol = solution.replace(/\*/g, '×').replace(/\//g, '÷');
        showMessage(`试试这个公式: ${displaySol}`);
    }

    function checkResult() {
        if (usedCardIndices.length !== 4) {
            showMessage("请使用所有4个数字卡片", true);
            triggerShake();
            return;
        }
        let expression = inputStack.map(item => item.value).join('');
        try {
            if (/[^0-9+\-*/().]/.test(expression)) throw new Error("Invalid");
            const result = eval(expression);
            if (Math.abs(result - 24) < 0.0001) {
                gameWin();
            } else {
                gameLose(result);
            }
        } catch (e) {
            showMessage("公式格式有误，请检查", true);
            triggerShake();
        }
    }

    function gameWin() {
        const display = document.getElementById('display');
        display.textContent = "= 24  (胜利!)";
        display.classList.add('success');
        showMessage("算对啦！太棒了！");
    }

    function gameLose(result) {
        const display = document.getElementById('display');
        display.classList.add('error');
        let showRes = Math.round(result * 100) / 100;
        showMessage(`结果是 ${showRes}，不是 24 哦`, true);
        
        // 动画结束后移除 error 类以便下次触发
        setTimeout(() => {
            display.classList.remove('error');
        }, 500);
    }

    function showMessage(msg, isError = false) {
        const area = document.getElementById('message-area');
        area.style.color = isError ? '#ff6b6b' : '#a4b0be';
        area.textContent = msg;
    }

    function triggerShake() {
        const display = document.getElementById('display');
        // 移除再添加以重新触发动画
        display.classList.remove('error');
        void display.offsetWidth; // 强制重绘
        display.classList.add('error');
        setTimeout(() => display.classList.remove('error'), 500);
    }

    // 核心求解算法 (保持不变)
    function solve24(nums) {
        let list = nums.map(n => ({ val: n, exp: n.toString() }));
        return solveRecursive(list);
    }
    function solveRecursive(list) {
        if (list.length === 1) {
            if (Math.abs(list[0].val - 24) < 0.0001) return list[0].exp;
            return null;
        }
        for (let i = 0; i < list.length; i++) {
            for (let j = 0; j < list.length; j++) {
                if (i === j) continue;
                let a = list[i], b = list[j];
                let nextList = [];
                for (let k = 0; k < list.length; k++) if (k !== i && k !== j) nextList.push(list[k]);
                
                let res;
                nextList.push({ val: a.val + b.val, exp: `(${a.exp}+${b.exp})` });
                if (res = solveRecursive(nextList)) return res;
                nextList.pop();

                nextList.push({ val: a.val * b.val, exp: `(${a.exp}*${b.exp})` });
                if (res = solveRecursive(nextList)) return res;
                nextList.pop();
                
                nextList.push({ val: a.val - b.val, exp: `(${a.exp}-${b.exp})` });
                if (res = solveRecursive(nextList)) return res;
                nextList.pop();

                if (b.val !== 0) {
                    nextList.push({ val: a.val / b.val, exp: `(${a.exp}/${b.exp})` });
                    if (res = solveRecursive(nextList)) return res;
                    nextList.pop();
                }
            }
        }
        return null;
    }

    initGame();
</script>

</body>
</html>